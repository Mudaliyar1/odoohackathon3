<%- include('../partials/flash') %>

<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2">Stock Adjustment Details</h1>
</div>

<div class="card mb-3">
    <div class="card-header">
        Adjustment #<%= adjustment.documentNumber %>
    </div>
    <div class="card-body">
        <p><strong>Warehouse:</strong> <%= adjustment.warehouse.name %></p>
        <p><strong>Type:</strong> <%= adjustment.type %></p>
        <p><strong>Status:</strong> <%= adjustment.status %></p>
        <p><strong>Created By:</strong> <%= adjustment.createdBy.username %></p>
        <p><strong>Created At:</strong> <%= adjustment.createdAt.toLocaleString() %></p>
        <% if (adjustment.status === 'completed') { %>
            <p><strong>Validated By:</strong> <%= adjustment.validatedBy.username %></p>
            <p><strong>Validation Date:</strong> <%= adjustment.validationDate.toLocaleString() %></p>
        <% } %>

        <h4 class="mt-4">Product Lines</h4>
        <div class="table-responsive">
            <table class="table table-sm table-bordered">
                <thead>
                    <tr>
                        <th>Product Name</th>
                        <th>SKU</th>
                        <th>Quantity</th>
                    </tr>
                </thead>
                <tbody>
                    <% adjustment.lines.forEach(line => { %>
                        <tr>
                            <td><%= line.product.name %></td>
                            <td><%= line.product.sku %></td>
                            <td><%= line.quantity %></td>
                        </tr>
                    <% }); %>
                </tbody>
            </table>
        </div>

        <div class="mt-3">
            <a href="/adjustments" class="btn btn-secondary">Back to Stock Adjustments</a>
            <% if (adjustment.status === 'pending') { %>
                <form action="/adjustments/<%= adjustment._id %>/validate" method="POST" style="display: inline;">
                    <button type="submit" class="btn btn-success">Validate Adjustment</button>
                </form>
            <% } %>
        </div>
    </div>
</div>